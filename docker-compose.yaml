version: '3.7'

services:
  cogment-js-sdk:
    build:
      context: .
      dockerfile: test.dockerfile

  echo:
    build:
      context: ./__tests__/end-to-end/cogment-app/echo
      dockerfile: ../py_service.dockerfile
    volumes:
      - ./__tests__/end-to-end/cogment-app/:/app
    environment:
      COGMENT_GRPC_REFLECTION: 1
      PYTHONUNBUFFERED: 1
    x-cogment:
      ports:
        - port: 9000
    restart: on-failure

  environment:
    build:
      context: ./__tests__/end-to-end/cogment-app/environment
      dockerfile: ../py_service.dockerfile
    volumes:
      - ./__tests__/end-to-end/cogment-app/:/app
    environment:
      COGMENT_GRPC_REFLECTION: 1
      PYTHONUNBUFFERED: 1
    x-cogment:
      ports:
        - port: 9000
    restart: on-failure

  orchestrator:
    build:
      context: ./__tests__/end-to-end/cogment-app/
      dockerfile: orchestrator.dockerfile
    environment:
      HTTP_PORT: 8081
    depends_on:
      - environment
      - echo
    restart: on-failure
    ports:
      - 8081:8081/tcp

